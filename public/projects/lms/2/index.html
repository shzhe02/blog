<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>[Part 2] Technical Implementation | cornerboxes</title>
<meta name="keywords" content="">
<meta name="description" content="To recap, the requirements I set for this systems are the following:
Be digital. Support multiple devices and syncing. Allow the user to remain in full control of their data. Be easy to set up. Being Digital In order to tackle requirements 2 and 3, requirement 1 will have to be fulfilled. In other words, the system will have to be bundled into an app. As most people already have their phones on them at all times, there is no more convenient option than just using an app and not needing to bring any additional equipment with oneself on the go.">
<meta name="author" content="Harvey Lim">
<link rel="canonical" href="https://cornerboxes.com/projects/lms/2/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.a0319c6392ae11d059810c5960f3fbda7811f33bf5388b058fa5d2eebe13953d.css" integrity="sha256-oDGcY5KuEdBZgQxZYPP72ngR8zv1OIsFj6XS7r4TlT0=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://cornerboxes.com/favicon.ico">
<link rel="apple-touch-icon" href="https://cornerboxes.com/apple-touch-icon.png">

<meta name="twitter:title" content="[Part 2] Technical Implementation | cornerboxes" />
<meta name="twitter:description" content="To recap, the requirements I set for this systems are the following:
Be digital. Support multiple devices and syncing. Allow the user to remain in full control of their data. Be easy to set up. Being Digital In order to tackle requirements 2 and 3, requirement 1 will have to be fulfilled. In other words, the system will have to be bundled into an app. As most people already have their phones on them at all times, there is no more convenient option than just using an app and not needing to bring any additional equipment with oneself on the go." />
<meta property="og:title" content="[Part 2] Technical Implementation | cornerboxes" />
<meta property="og:description" content="To recap, the requirements I set for this systems are the following:
Be digital. Support multiple devices and syncing. Allow the user to remain in full control of their data. Be easy to set up. Being Digital In order to tackle requirements 2 and 3, requirement 1 will have to be fulfilled. In other words, the system will have to be bundled into an app. As most people already have their phones on them at all times, there is no more convenient option than just using an app and not needing to bring any additional equipment with oneself on the go." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cornerboxes.com/projects/lms/2/" />
<meta property="article:section" content="projects" />
  <meta property="article:published_time" content="2023-10-08T14:14:23&#43;03:00" />
  <meta property="article:modified_time" content="2023-10-08T14:14:23&#43;03:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Projects",
      "item": "https://cornerboxes.com/projects/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Project LMS",
      "item": "https://cornerboxes.com/projects/lms/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "[Part 2] Technical Implementation",
      "item": "https://cornerboxes.com/projects/lms/2/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "[Part 2] Technical Implementation | cornerboxes",
  "name": "[Part 2] Technical Implementation",
  "description": "To recap, the requirements I set for this systems are the following:\nBe digital. Support multiple devices and syncing. Allow the user to remain in full control of their data. Be easy to set up. Being Digital In order to tackle requirements 2 and 3, requirement 1 will have to be fulfilled. In other words, the system will have to be bundled into an app. As most people already have their phones on them at all times, there is no more convenient option than just using an app and not needing to bring any additional equipment with oneself on the go.",
  "keywords": [
    
  ],
  "wordCount" : "1078",
  "inLanguage": "en",
  "datePublished": "2023-10-08T14:14:23+03:00",
  "dateModified": "2023-10-08T14:14:23+03:00",
  "author":{
    "@type": "Person",
    "name": "Harvey Lim"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cornerboxes.com/projects/lms/2/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "cornerboxes",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cornerboxes.com/favicon.ico"
    }
  }
}
</script>
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary-bg: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list-page {
                background: var(--theme);
            }

            .list-page:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list-page:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

</head>

<body class=" type-projects kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'auto';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://cornerboxes.com/" accesskey="h" title="cornerboxes (Alt + H)">cornerboxes</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://cornerboxes.com/projects/" title="Projects" class="active"
                >Projects
                </a>
            </li>
            <li>
                <a href="https://cornerboxes.com/thoughtbooks/" title="Thoughtbooks"
                >Thoughtbooks
                </a>
            </li>
            <li>
                <a href="https://cornerboxes.com/misc/" title="Misc"
                >Misc
                </a>
            </li>
            <li>
                <a href="https://cornerboxes.com/archives/" title="Archive"
                >Archive
                </a>
            </li>
            <li>
                <a href="https://cornerboxes.com/search/" title="Search (Alt &#43; /)"data-no-instant accesskey=/
                >Search
                </a>
            </li>
            <li>
                <a href="https://cornerboxes.com/about/" title="About"
                >About
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://cornerboxes.com/">Home</a>&nbsp;»&nbsp;<a href="https://cornerboxes.com/projects/">Projects</a>&nbsp;»&nbsp;<a href="https://cornerboxes.com/projects/lms/">Project LMS</a></div><h1 class="post-title">[Part 2] Technical Implementation</h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>October 8, 2023</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>6 min</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg"width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="7" r="4"></circle><path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"></path></svg>
  <span>Harvey Lim</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#being-digital" aria-label="Being Digital">Being Digital</a></li>
                <li>
                    <a href="#multi-device-support" aria-label="Multi-device Support">Multi-device Support</a></li>
                <li>
                    <a href="#syncing" aria-label="Syncing">Syncing</a><ul>
                        
                <li>
                    <a href="#p2p-peer-to-peer-synchronization-system" aria-label="P2P (Peer-to-Peer) synchronization system">P2P (Peer-to-Peer) synchronization system</a></li>
                <li>
                    <a href="#server-system" aria-label="Server system">Server system</a></li>
                <li>
                    <a href="#verdict" aria-label="Verdict">Verdict</a></li></ul>
                </li>
                <li>
                    <a href="#server-database" aria-label="Server Database">Server Database</a></li>
                <li>
                    <a href="#tldr" aria-label="TL;DR">TL;DR</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>To recap, the requirements I set for this systems are the following:</p>
<ol>
<li>Be digital.</li>
<li>Support multiple devices and syncing.</li>
<li>Allow the user to remain in full control of their data.</li>
<li>Be easy to set up.</li>
</ol>
<h1 id="being-digital">Being Digital<a hidden class="anchor" aria-hidden="true" href="#being-digital">¶</a></h1>
<p>In order to tackle requirements 2 and 3, requirement 1 will have to be fulfilled. In other words, the system will have to be bundled into an app. As most people already have their phones on them at all times, there is no more convenient option than just using an app and not needing to bring any additional equipment with oneself on the go.</p>
<h1 id="multi-device-support">Multi-device Support<a hidden class="anchor" aria-hidden="true" href="#multi-device-support">¶</a></h1>
<p>For the app to have multi-device support (first part of requirement 2), I <em>could</em> create 3-4 different native implementations for each type of device, but that would be far too much work. Instead, using a cross-platform framework of some kind would be more ideal. After some research, my options are the following:</p>
<ul>
<li>Create a web app using a JavaScript framework (React, Vue) then turn it into mobile app using Electron or Capacitor.</li>
<li>Use a cross-platform framework like Flutter or React Native.</li>
</ul>
<p>Since I&rsquo;ve previously built applications with Flutter before, I will be using it as my framework of choice. However, my previous applications were quite simple in comparison with what I&rsquo;m trying to achieve with this project, therefore I will be making several sub-projects to get the hang of it in the process.</p>
<p>However, going with Flutter has a downside that may affect  the third requirement: telemetry. As Google is the main creator of Flutter, there may be some hidden telemetry baked into Flutter, causing the users&rsquo; data to be slightly compromised. Despite this, I believe I will still have to stick with Flutter, as using any alternative approach would slow down the development process. I will however manually disable as much telemetry as I can.</p>
<h1 id="syncing">Syncing<a hidden class="anchor" aria-hidden="true" href="#syncing">¶</a></h1>
<p>As for the second part of requirement 2, that is, data syncing, there are two options:</p>
<ol>
<li>Using a peer-to-peer synchronization system like <a href="https://syncthing.net/">Syncthing</a>.</li>
<li>Using a cloud-hosted server to host a database, which is where the data will be stored.</li>
</ol>
<p>Here are some pros and cons of each.</p>
<h2 id="p2p-peer-to-peer-synchronization-system">P2P (Peer-to-Peer) synchronization system<a hidden class="anchor" aria-hidden="true" href="#p2p-peer-to-peer-synchronization-system">¶</a></h2>
<p>Pros:</p>
<ul>
<li>No server required = No extra costs</li>
<li>No authentication required.
<ul>
<li>As you have to manually connect your devices to one another directly, there is nearly no risk of someone stealing your data as all of it is stored solely on devices you own, and none of them require access to the internet to synchronize.</li>
</ul>
</li>
</ul>
<p>Cons:</p>
<ul>
<li>Connecting each device you have to each other will be tedious for the setup process.</li>
<li>Implementation will be quite difficult.</li>
<li>Conflict resolving may be common = worse ease of use
<ul>
<li>For example, you have two devices which are unable to sync with each other, but edit the same file on each of them. Then, sync the two devices. The two devices will have two files that were edited since they were last connected and do not know which one is the correct file.</li>
</ul>
</li>
<li>No redundancy.
<ul>
<li>For example, you left the house for a work trip with just your phone, but a week into your trip, your phone&rsquo;s storage gets corrupted. All the data you entered during the first week of the trip is now permanently gone.</li>
</ul>
</li>
</ul>
<h2 id="server-system">Server system<a hidden class="anchor" aria-hidden="true" href="#server-system">¶</a></h2>
<p>Pros:</p>
<ul>
<li>Redundancy.
<ul>
<li>As all the data on any one device is kept in sync with the server, if the device fails, fetching the data from the server should restore what was lost.</li>
</ul>
</li>
<li>Simpler device-side setup.
<ul>
<li>Ideally, it will just be putting in the IP address (or domain name) of the server and authenticating yourself, and everything should be synced.</li>
</ul>
</li>
<li>Implementation may be simple.
<ul>
<li>There are several server database solutions available already with good documentation, and some even have specific guides for use with Flutter.</li>
</ul>
</li>
<li>Flexibility.
<ul>
<li>With a server, additional features become feasible. For example, multi-user support, which I plan to do as implementing authentication is already required for this implementation.</li>
</ul>
</li>
</ul>
<p>Cons:</p>
<ul>
<li>Cost.
<ul>
<li>An external server will be required. If using a low-cost VPS (Virtual Private Server), the costs may be about 4-5 euros a month.</li>
</ul>
</li>
<li>Potentially complex server-side setup.
<ul>
<li>There will likely be additional complexity from needing to set up the server securely, as the server is accessible by anyone on the internet.</li>
</ul>
</li>
</ul>
<h2 id="verdict">Verdict<a hidden class="anchor" aria-hidden="true" href="#verdict">¶</a></h2>
<p>Based on the list above, I have decided to use a server-based setup, with the main convincing points being redundancy and flexibility. I feel like I can justify the cons with the following:</p>
<ul>
<li>Cost
<ul>
<li>Many current free digital productivity systems have catches to prevent abuse of their systems, and they make users pay for either higher limits or additional functionalities (like syncing). The same amount of money in their paid tiers tends to be enough to afford a low-cost VPS.</li>
</ul>
</li>
<li>Potentially complex server-side setup.
<ul>
<li>As this system is intended for my personal use, I personally don&rsquo;t mind the additional tinkering to get things up and running. However, if there is a future demand for it, I believe creating a script for a very quick setup experience on the server could be achievable. For example, something like the <a href="https://github.com/pterodactyl-installer/pterodactyl-installer">Pterodactyl setup script</a>, which drastically simplifies the setup for Pterodactyl.</li>
</ul>
</li>
</ul>
<h1 id="server-database">Server Database<a hidden class="anchor" aria-hidden="true" href="#server-database">¶</a></h1>
<p>As using a server as a database is actually fairly common, there are ready-made solutions that are open-source. I previously hinted at this previously:</p>
<blockquote>
<p>There are several server database solutions available already with good documentation, and some even have specific guides for use with Flutter.</p>
</blockquote>
<p>Some may have heard of Google&rsquo;s Firebase, which I have used before. However, there are actually a fair amount of alternatives, and given Google&rsquo;s track record with telemetry, I think it&rsquo;d be wise to use something else.</p>
<p>Here&rsquo;s what I found:</p>
<ul>
<li><a href="https://pocketbase.io/">Pocketbase</a>
<ul>
<li>Pros:
<ul>
<li>One file, very simple.</li>
</ul>
</li>
<li>Cons:
<ul>
<li>Uses sqlite in the background, may not be the most performant.</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://supabase.com/">Supabase</a>
<ul>
<li>Pros:
<ul>
<li>Scales up very well.</li>
</ul>
</li>
<li>Cons:
<ul>
<li>More complex.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>I decided to try out Pocketbase because:</p>
<ul>
<li>Simple is best. I want to focus more of my time on creating good user-side applications and less time debugging the server-related code.</li>
<li>This system is intended for a very small group of people to use (1 person ideally, maybe 5-10 people max), which means the scalability of Supabase will likely not be very useful.</li>
<li>After checking out some <a href="https://github.com/pocketbase/benchmarks/blob/master/results/hetzner_cax11_cgo.md">benchmarks for Pocketbase</a>, it seems that creating thousands of posts will only take a few seconds, which is more than any individual (or small group of individuals) will need.</li>
</ul>
<h1 id="tldr">TL;DR<a hidden class="anchor" aria-hidden="true" href="#tldr">¶</a></h1>
<ul>
<li>App framework: Flutter</li>
<li>Multi-device support implementation: Server
<ul>
<li>Server database (backend): Pocketbase</li>
</ul>
</li>
</ul>


  </div>

  

  
  
  <footer class="post-footer">
testing


<nav class="paginav">
  <a class="prev" href="https://cornerboxes.com/projects/lms/1/">
    <span class="title">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select: text;"><line x1="19" y1="12" x2="5" y2="12" style="user-select: text;"></line><polyline points="12 19 5 12 12 5" style="user-select: text;"></polyline></svg>&nbsp;Prev Page</span>
    <br>
    <span>[Part 1] Origin</span>
  </a>
</nav>

  </footer>
    <div class="comments-separator"></div><script src="https://utteranc.es/client.js"
        repo="shzhe02/blog-comments"
        issue-term="pathname"
        label="Comments"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
</script>

</article>
    </main>
    
<footer class="footer">
  <span>&copy; 2024 <a href="https://cornerboxes.com/">cornerboxes</a></span><span style="display: inline-block; margin-left: 1em;">
    <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a>
  </span>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
    if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
      mybutton.style.visibility = "visible";
      mybutton.style.opacity = "1";
    } else {
      mybutton.style.visibility = "hidden";
      mybutton.style.opacity = "0";
    }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>
<script>
  mediumZoom('.entry-cover img');
  mediumZoom('.post-content img:not([no-zoom])');
</script>

</body>

</html>
